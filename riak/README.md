Riak Client for Yahoo! Cloud System Benchmark (YCSB)
====================================================

The Riak YCSB client is designed to work with the Yahoo! Cloud System Benchmark (YCSB) project (https://github.com/brianfrankcooper/YCSB) to support performance testing of the Riak database.

Configuring Riak for KV Testing
----------------

<blockquote>
Set the default backend for Riak to LevelDB in riak.conf (required to support secondary indexes used for the "scan" workloads)*:
</blockquote>

```
storage_backend = leveldb
```

<blockquote>
Create the "ycsb" bucket type by logging into one of the nodes in your cluster and run the following riak-admin commands:
</blockquote>

```
riak-admin bucket-type create ycsb '{"props":{"allow_mult":"false"}}'
riak-admin bucket-type activate ycsb
```  

* Modify NODES_ARRAY in RiakDBClient.java to include all of the nodes in your Riak test cluster.

```
// Array of nodes in the Riak cluster or load balancer in front of the cluster
private static final String[] NODES_ARRAY = {"127.0.0.1"};
```

* Build the YCSB project by running the following command in the YCSB root

```
mvn clean package
```

* Load and run a YCSB workload using the Riak client:

```
./bin/ycsb load riak -P workloads/workloada
./bin/ycsb run riak -P workloads/workloada
```

Configuring Riak for TS Testing
-------------------------------

Riak will be configured out of the box for default Timeseries support, all that will need to be done is create the TS table

```
#!/bin/bash

JSON="{\"props\": {\"table_def\": \"CREATE TABLE tsycsb (
     host VARCHAR NOT NULL,
     worker VARCHAR NOT NULL,
     time TIMESTAMP NOT NULL,
     field0 VARCHAR,
     field1 VARCHAR,
     field2 VARCHAR,
     field3 VARCHAR,
     field4 VARCHAR,
     field5 VARCHAR,
     field6 VARCHAR,
     field7 VARCHAR,
     field8 VARCHAR,
     field9 VARCHAR,
     primary key ((host, worker, quantum(time, 10, s)), host, worker, time))
\"}}"

./riak-admin bucket-type create tsycsb ${JSON}
./riak-admin bucket-type activate tsycsb
```

Load and run a YCSB workload using the Riak TS client

```
./bin/ycsb load riak-ts -P workloads/workloada
./bin/ycsb run riak-ts -P workloads/workloada
```

Timeseries-specific Configuration
---------------------------------

```
alltypeschema=true
```

This will use a separate, preset schema that exercises all data types supported in Riak TS, you can use the following schema with this option

```
#!/bin/bash

JSON="{\"props\": {\"table_def\": \"CREATE TABLE tsycsb (myfamily varchar not null, myseries varchar not null, time timestamp not null, myint sint64 not null, mytext varchar not null, myfloat double not null, mybool boolean not null, PRIMARY KEY ((myfamily, myseries, quantum(time, 15, 'm')), myfamily, myseries, time))\"}}"

./riak-admin bucket-type create tsycsb ${JSON}
./riak-admin bucket-type activate tsycsb
```

```
riak.scan_size
```

Defines exactly how many records to return when performing a range scan test

```
useowntimestamp=true
initialtimestamp=1
```

When performing loads and inserts, this will define what timestamp to start at. Otherwise, timestamps are generated by YCSB

---

<b>Note</b>: For more information on workloads and how to run them please see: https://github.com/brianfrankcooper/YCSB/wiki/Running-a-Workload
